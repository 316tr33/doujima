# クライアント引き継ぎガイド

堂島フロント企画様へのフォーム機能引き継ぎ資料です。

## 実装完了内容

お問い合わせフォームと採用応募フォームの送信機能を実装しました。

### 実装した機能

✅ **お問い合わせフォーム** (`index.html`)
- 会社名、担当者名、メールアドレス、電話番号、サービス種別、希望実施日、参加人数、要望・詳細の入力
- 入力内容を指定のメールアドレスに自動送信

✅ **採用応募フォーム** (`recruit.html`)
- 氏名、フリガナ、メールアドレス、電話番号、年齢、住所、応募職種、経験・資格、応募理由、メッセージの入力
- 入力内容を指定のメールアドレスに自動送信

✅ **セキュリティ機能**
- スパムボット対策（Cloudflare Turnstile + ハニーポット）
- レート制限（同一IPから5分間に3回まで）
- データバリデーション（必須項目チェック、形式チェック）

✅ **プライバシーポリシー**
- 個人情報保護方針を記載した専用ページ（`privacy-policy.html`）

---

## システム構成

```
ユーザー → Webサイト → Cloudflare Pages → Resend → メール受信
                           ↓
                    セキュリティ検証
                    - Turnstile（ボット対策）
                    - ハニーポット
                    - レート制限
```

### 使用サービス

| サービス | 用途 | 料金 |
|----------|------|------|
| Cloudflare Pages | ホスティング | 無料 |
| Cloudflare Turnstile | ボット対策 | 無料 |
| Cloudflare KV | レート制限 | 無料 |
| Resend | メール送信 | 無料（3,000通/月） |

---

## 必要なアカウント情報

### 1. Cloudflare アカウント

**ログイン情報:**
- URL: https://dash.cloudflare.com/
- メールアドレス: [クライアント様のメールアドレス]
- プロジェクト名: `doujima`

**管理できること:**
- サイトの公開/非公開
- 環境変数の変更（受信先メールアドレスなど）
- デプロイ履歴の確認
- アクセス統計の確認

### 2. Resend アカウント

**ログイン情報:**
- URL: https://resend.com/
- メールアドレス: [クライアント様のメールアドレス]

**管理できること:**
- メール送信履歴の確認
- 送信成功率の確認
- API キーの管理
- 送信制限の確認（月間3,000通）

**重要**: Resend アカウントは**クライアント様ご自身で作成**していただく必要があります。現在はテスト用アカウントで動作しています。

---

## クライアント様にご対応いただく作業

### 作業1: Resend アカウントの作成

**所要時間**: 約10分

1. https://resend.com/ にアクセス
2. 「Sign Up」からアカウント作成
3. 無料プラン（3,000通/月）を選択
4. ドメイン `doujimafront.com` を追加
5. 表示される DNS レコードを開発者に共有

**DNS レコード例:**
```
Type: TXT
Name: @
Content: v=spf1 include:resend.com ~all

Type: CNAME
Name: resend._domainkey
Content: resend._domainkey.resend.com
```

6. API キーを作成（権限: Sending access）
7. 作成された API キーを開発者に共有（セキュア方式で）

### 作業2: 受信先メールアドレスの指定

フォーム送信時のメール受信先を指定してください。

**デフォルト設定:**
- お問い合わせ: `info@doujimafront.com`
- 採用応募: `info@doujimafront.com`

変更が必要な場合は開発者にご連絡ください。

### 作業3: DNS 設定の確認

お名前.com から Cloudflare にネームサーバーを変更していることを確認してください。

**確認方法:**
```bash
nslookup -type=ns doujimafront.com
```

Cloudflare のネームサーバー（`xxx.ns.cloudflare.com`）が表示されればOKです。

---

## 日常的な管理作業

### メール受信の確認

フォームから送信された内容は、指定のメールアドレスに届きます。

**メール形式:**
- 件名: `【お問い合わせ】会社名 - サービス種別` または `【採用応募】氏名 - 応募職種`
- 本文: HTML 形式で整形された入力内容
- フッター: 送信日時、送信元IPアドレス

**届かない場合の確認:**
1. 迷惑メールフォルダを確認
2. Resend ダッシュボードで送信履歴を確認
3. Cloudflare ログで ログを確認

### 送信制限の監視

Resend の無料プランは月間3,000通までです。

**確認方法:**
1. Resend ダッシュボード → 「Usage」
2. 月間送信数を確認

**超過しそうな場合:**
- 有料プラン（$20/月〜）へのアップグレードを検討
- または別のメールサービス（SendGrid、Mailgunなど）への移行

### スパム対策の確認

Cloudflare Turnstile と ハニーポット でスパムボットを自動的にブロックします。

**統計確認:**
1. Cloudflare Dashboard → 「Turnstile」
2. ブロック数、成功率を確認

**レート制限:**
- 同一IPから5分間に3回まで送信可能
- 超過した場合は自動的にエラーメッセージを表示

---

## トラブルシューティング

### 問題1: メールが届かない

**確認事項:**
1. Resend でドメイン認証が完了しているか
2. 送信履歴に記録があるか（Resend ダッシュボード）
3. 迷惑メールフォルダを確認
4. 受信先メールアドレスが正しく設定されているか

**対処法:**
- Cloudflare の環境変数 `RECIPIENT_EMAIL` を確認
- Resend の DNS 設定を確認

### 問題2: フォーム送信時にエラーが表示される

**よくあるエラー:**

| エラーメッセージ | 原因 | 対処法 |
|-----------------|------|--------|
| セキュリティ検証が完了していません | Turnstile 未チェック | 少し待ってから送信 |
| メール送信に失敗しました | Resend API エラー | Resend アカウントを確認 |
| 送信回数が制限を超えました | レート制限 | 5分待ってから再送信 |

**開発者への連絡が必要な場合:**
- 上記以外のエラーメッセージが表示される
- エラーが頻繁に発生する
- 環境変数の変更が必要

### 問題3: サイトが表示されない

**確認事項:**
1. DNS が正しく設定されているか
2. Cloudflare Pages のデプロイが成功しているか
3. SSL/TLS 証明書が有効か

**対処法:**
1. Cloudflare Dashboard → プロジェクト「doujima」→「Deployments」
2. 最新のデプロイが「Success」になっているか確認
3. 失敗している場合は「Retry deployment」をクリック

---

## 連絡先

### 開発者への連絡

フォーム機能に関する技術的な質問、エラー、変更依頼は開発者にご連絡ください。

**連絡事項の例:**
- 受信先メールアドレスを変更したい
- フォームの項目を追加/削除したい
- エラーが頻繁に発生する
- 環境変数を変更したい

### Resend サポート

Resend のアカウント、メール送信に関する問題は Resend サポートにご連絡ください。

- サポート: https://resend.com/support
- ドキュメント: https://resend.com/docs

### Cloudflare サポート

Cloudflare のアカウント、ホスティングに関する問題は Cloudflare サポートにご連絡ください。

- サポート: https://support.cloudflare.com/
- コミュニティ: https://community.cloudflare.com/

---

## よくある質問（FAQ）

### Q1: フォームの項目を追加できますか？

**A:** 可能です。開発者に以下の情報をお伝えください：
- 追加したい項目名
- 必須/任意
- 入力形式（テキスト、数値、選択肢など）

### Q2: 受信先メールアドレスを複数設定できますか？

**A:** 可能です。開発者に受信先メールアドレスのリストをお伝えください。全てのアドレスにメールが送信されます。

### Q3: 月間3,000通を超えるとどうなりますか？

**A:** Resend の無料プランは月間3,000通までです。超過すると送信できなくなります。有料プラン（$20/月〜）へのアップグレードをご検討ください。

### Q4: メールのデザインを変更できますか？

**A:** 可能です。開発者にご相談ください。現在は金色（#b8860b）を基調としたデザインになっています。

### Q5: スパムメールが増えた場合はどうすればいいですか？

**A:** Turnstile とハニーポットで大部分のスパムはブロックされますが、それでも増える場合は開発者にご相談ください。レート制限の強化など、追加対策を実施できます。

### Q6: バックアップはありますか？

**A:** はい。Cloudflare Pages は Git リポジトリと連携しており、全ての変更履歴が保存されています。問題が発生した場合は過去のバージョンにロールバックできます。

### Q7: 運用コストはいくらですか？

**A:** 基本的には無料です（月間3,000通まで）。月間送信数が3,000通を超える場合は Resend の有料プラン（$20/月〜）が必要です。

---

## チェックリスト

### 引き継ぎ時

- [ ] Cloudflare アカウント情報を共有
- [ ] Resend アカウント作成依頼
- [ ] DNS 設定の確認
- [ ] フォーム送信テスト（お問い合わせ）
- [ ] フォーム送信テスト（採用応募）
- [ ] メール受信確認
- [ ] プライバシーポリシーページ確認
- [ ] ドキュメント一式の共有

### 運用開始後

- [ ] 週次でメール受信を確認
- [ ] 月次で Resend 送信数を確認
- [ ] 月次で Cloudflare アクセス統計を確認
- [ ] 問題発生時は速やかに開発者に連絡

---

## 関連ドキュメント

より詳しい技術情報が必要な場合は、以下のドキュメントをご参照ください：

1. [Cloudflare セットアップガイド](./cloudflare-setup.md) - Cloudflare の詳細設定
2. [フォーム統合ガイド](./form-integration-guide.md) - フォームの仕様と実装詳細
3. [デプロイガイド](./deployment-guide.md) - デプロイ手順とトラブルシューティング

---

## 本番環境情報

**本番URL:** https://doujimafront.com

**フォームページ:**
- お問い合わせ: https://doujimafront.com/#contact
- 採用応募: https://doujimafront.com/recruit.html
- プライバシーポリシー: https://doujimafront.com/privacy-policy.html

**管理画面:**
- Cloudflare: https://dash.cloudflare.com/
- Resend: https://resend.com/

---

## 更新履歴

| 日付 | 変更内容 |
|------|----------|
| 2025-01-10 | 初版作成 - Resend 統合完了 |

---

以上で引き継ぎ資料は完了です。ご不明点がございましたら、いつでも開発者にご連絡ください。
